// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  username          String   @unique
  pterodactylUserId Int
  pterodactylUuid   String
  isAdmin           Boolean  @default(false)
  avatarUrl         String?
  createdAt         DateTime @default(now())
  lastLogin         DateTime @default(now())
  tickets           Ticket[]
  messages          TicketMessage[]
}

model Ticket {
  id        String          @id @default(uuid())
  subject   String
  status    String          @default("OPEN") // OPEN, CLOSED, ANSWERED
  userId    String
  user      User            @relation(fields: [userId], references: [id])
  messages  TicketMessage[]
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
}

model TicketMessage {
  id        String   @id @default(uuid())
  content   String
  isAdmin   Boolean  @default(false)
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  ticketId  String
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  createdAt DateTime @default(now())
}

model Setting {
  id               String   @id @default("site-settings")
  siteTitle        String   @default("Navdactyl")
  siteDescription String   @default("Premium Pterodactyl Client Portal")
  faviconUrl       String   @default("/favicon.ico")
  dashboardGreeting String   @default("Welcome to Navdactyl Dashboard. Happy Hosting!")
  announcementText String   @default("Welcome to Subdactyl Dashboard. Happy Hosting!")
  showAnnouncement Boolean  @default(true)
  turnstileEnabled  Boolean  @default(false)
  turnstileSiteKey  String?
  turnstileSecretKey String?
  
  // Free Server Defaults
  freeServerMemory Int     @default(4096)
  freeServerDisk   Int     @default(10240)
  freeServerCpu    Int     @default(100)
  serverLimit      Int     @default(2)
  allowedNodes     String? // Comma separated IDs: "1,2,3"
  pterodactylAccountKey String?
  
  updatedAt        DateTime @updatedAt
}
